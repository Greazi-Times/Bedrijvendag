import{d as D,j as v,y as q,n as F,p as K,L as T,c,o as u,a as b,u as i,h as B,w as h,e as r,z as M,m as p,A as f,B as w,t as m,K as k,F as _,r as V,f as g,q as N,s as I,I as z}from"./app-BB1wLqHH.js";import{_ as S}from"./index-fFqgNZJi.js";import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-ISkciXjy.js";import"./useForwardExpose-DuPeKSsG.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-B5ZgElup.js";import"./createLucideIcon-BiwFXBxA.js";import"./VisuallyHidden-k42m46qh.js";import"./RovingFocusGroup-D2axv7HO.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./users-lES42Api.js";const W={class:"flex items-center justify-between"},X={class:"m-8 h-[calc(100vh-150px)] w-full rounded-xl border border-sidebar-border/70 bg-white p-8 shadow"},H={class:"flex gap-6"},P={class:"flex-1"},G={key:0,class:"mt-1 text-sm text-red-500"},J={class:"w-1/3"},Q={key:0,class:"mt-1 text-sm text-red-500"},Y={class:"flex items-center pt-6"},Z={class:"inline-flex items-center space-x-2"},ee={key:0,class:"mt-1 text-sm text-red-500"},te={class:"mt-2 flex flex-wrap gap-2"},se=["value"],oe={key:0,class:"mt-1 text-sm text-red-500"},re={class:"mt-2 flex flex-wrap gap-2"},ie=["value"],ne={key:0,class:"mt-1 text-sm text-red-500"},le={class:"relative w-72"},ae=["src"],de={key:0,class:"mt-1 text-sm text-red-500"},ce={class:"flex items-center justify-end gap-4"},ue={key:0,class:"mt-4 font-medium text-green-600"},ke=D({__name:"CompanyEdit",props:{company:{type:Object,required:!0},editions:{type:Array,required:!0},sectors:{type:Array,required:!0}},setup(E){const C=v(null),l=E,y=v(l.company.logo),t=q({name:l.company.name,description:l.company.description?l.company.description.replace(/<br\s*\/?>/g,`
`):"",href:l.company.href,visible:l.company.visible,editions:Array.isArray(l.company.editions)?[...l.company.editions]:[],sectors:Array.isArray(l.company.sectors)?[...l.company.sectors]:[],logo:null}),R=s=>{const e=s.target;if(e.files&&e.files[0]){const o=e.files[0];t.logo=o,y.value=URL.createObjectURL(o)}},$=async()=>{const s=new FormData;s.append("_method","PUT");const e=l.company,o=n=>{const a=t[n],d=e[n];n==="editions"||n==="sectors"?Array.isArray(a)&&Array.isArray(d)&&(a.length!==d.length||a.some((x,j)=>x!==d[j]))&&a.forEach(x=>{s.append(`${n}[]`,x)}):a!==d&&a!==null&&a!==void 0&&s.append(n,a)};o("name"),o("description"),o("href"),o("visible"),o("editions"),o("sectors"),t.logo&&s.append("logo",t.logo);for(const[n,a]of s.entries());try{const n=await I.post(`/dashboard/company/${l.company.id}/update`,s,{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"multipart/form-data"}});alert("Company updated successfully!")}catch(n){console.error("Update failed:",n?.response?.data||n),alert("Update failed. Check console / laravel.log.")}},A=v(null),U=s=>{const e=A.value;if(!e)return;const o=e.selectionStart,n=e.selectionEnd,a=t.description.substring(o,n);let d=a;s==="bold"?d=`**${a||"bold text"}**`:s==="italic"?d=`*${a||"italic text"}*`:s==="underline"&&(d=`<u>${a||"underline text"}</u>`),t.description=t.description.substring(0,o)+d+t.description.substring(n),z(()=>{e.focus(),s==="underline"?e.setSelectionRange(o+3,o+d.length-4):s==="bold"?e.setSelectionRange(o+2,o+d.length-2):s==="italic"&&e.setSelectionRange(o+1,o+d.length-1)})},L=s=>{(s.metaKey||s.ctrlKey)&&s.key.toLowerCase()==="b"&&(s.preventDefault(),U("bold")),(s.metaKey||s.ctrlKey)&&s.key.toLowerCase()==="i"&&(s.preventDefault(),U("italic"))};return F(()=>window.addEventListener("keydown",L)),K(()=>l.company,s=>{s&&(t.name=s.name||"",t.description=s.description?s.description.replace(/<br\s*\/?>/g,`
`):"",t.href=s.href||"",t.visible=!!s.visible,t.editions=Array.isArray(s.editions)?[...s.editions]:[],t.sectors=Array.isArray(s.sectors)?[...s.sectors]:[],y.value=s.logo||"")},{immediate:!0}),T(()=>window.removeEventListener("keydown",L)),(s,e)=>(u(),c(_,null,[b(i(B),{title:"Edit Company"}),b(O,null,{default:h(()=>[r("div",W,[r("div",X,[e[17]||(e[17]=r("h1",{class:"mb-6 text-2xl font-semibold"},"Edit Company",-1)),r("form",{onSubmit:M($,["prevent"]),class:"space-y-6"},[r("div",H,[r("div",P,[e[8]||(e[8]=r("label",{class:"mb-1 block text-sm font-medium"},"Name",-1)),f(r("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>i(t).name=o),type:"text",class:"w-full rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200"},null,512),[[w,i(t).name]]),i(t).errors.name?(u(),c("p",G,m(i(t).errors.name),1)):p("",!0)]),r("div",J,[e[9]||(e[9]=r("label",{class:"mb-1 block text-sm font-medium"},"Website URL",-1)),f(r("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>i(t).href=o),type:"url",class:"w-full rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200"},null,512),[[w,i(t).href]]),i(t).errors.href?(u(),c("p",Q,m(i(t).errors.href),1)):p("",!0)]),r("div",Y,[r("label",Z,[f(r("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=o=>i(t).visible=o),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring focus:ring-indigo-200"},null,512),[[k,i(t).visible]]),e[10]||(e[10]=r("span",{class:"text-sm font-medium text-gray-700"},"Visible",-1))])])]),r("div",null,[e[11]||(e[11]=r("label",{class:"mb-1 block text-sm font-medium"},"Description",-1)),f(r("textarea",{ref_key:"textareaRef",ref:A,"onUpdate:modelValue":e[3]||(e[3]=o=>i(t).description=o),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200"},null,512),[[w,i(t).description]]),i(t).errors.description?(u(),c("p",ee,m(i(t).errors.description),1)):p("",!0)]),r("div",null,[e[12]||(e[12]=r("label",{class:"mb-1 block text-sm font-medium"},"Editions",-1)),r("div",te,[(u(!0),c(_,null,V(l.editions,o=>(u(),c("label",{key:o,class:"flex items-center gap-2"},[f(r("input",{type:"checkbox",value:o,"onUpdate:modelValue":e[4]||(e[4]=n=>i(t).editions=n)},null,8,se),[[k,i(t).editions]]),g(" "+m(o),1)]))),128))]),i(t).errors.editions?(u(),c("p",oe,m(i(t).errors.editions),1)):p("",!0)]),r("div",null,[e[13]||(e[13]=r("label",{class:"mb-1 block text-sm font-medium"},"Sectors",-1)),r("div",re,[(u(!0),c(_,null,V(l.sectors,o=>(u(),c("label",{key:o,class:"flex items-center gap-2 capitalize"},[f(r("input",{type:"checkbox",value:o,"onUpdate:modelValue":e[5]||(e[5]=n=>i(t).sectors=n)},null,8,ie),[[k,i(t).sectors]]),g(" "+m(o),1)]))),128))]),i(t).errors.sectors?(u(),c("p",ne,m(i(t).errors.sectors),1)):p("",!0)]),r("div",le,[e[15]||(e[15]=r("label",{class:"mb-1 block text-sm font-medium"},"Logo",-1)),r("div",{class:"group relative cursor-pointer overflow-hidden rounded-md border",onClick:e[6]||(e[6]=o=>C.value?.click())},[r("img",{src:y.value,alt:"Current logo",class:"aspect-[3/4] w-full object-cover"},null,8,ae),e[14]||(e[14]=r("div",{class:"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 transition group-hover:opacity-100"},[r("span",{class:"font-semibold text-white"},"Edit Logo")],-1))]),r("input",{ref_key:"logoInput",ref:C,type:"file",accept:"image/*",class:"hidden",onChange:R},null,544),i(t).errors.logo?(u(),c("p",de,m(i(t).errors.logo),1)):p("",!0)]),r("div",ce,[b(i(S),{type:"submit",disabled:i(t).processing},{default:h(()=>[g(m(i(t).processing?"Saving...":"Save Changes"),1)]),_:1},8,["disabled"]),b(i(S),{type:"button",variant:"destructive",onClick:e[7]||(e[7]=()=>{s.confirm("Are you sure you want to delete this company? This action cannot be undone.")&&i(N).visit(`/dashboard/company/${l.company.id}/remove`,{method:"put",preserveScroll:!0})})},{default:h(()=>e[16]||(e[16]=[g(" Delete ",-1)])),_:1,__:[16]})]),i(t).recentlySuccessful?(u(),c("p",ue,"Company updated successfully!")):p("",!0)],32)])])]),_:1})],64))}});export{ke as default};
