import{d as R,j as b,y as S,n as D,L as V,c as u,o as m,a as h,u as n,h as F,w as k,e as i,z as T,m as c,A as f,B as g,t as p,f as j,F as $,s as B,I}from"./app-BB1wLqHH.js";import{_ as K}from"./index-fFqgNZJi.js";import{_ as N}from"./AppLayout.vue_vue_type_script_setup_true_lang-ISkciXjy.js";import"./useForwardExpose-DuPeKSsG.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-B5ZgElup.js";import"./createLucideIcon-BiwFXBxA.js";import"./VisuallyHidden-k42m46qh.js";import"./RovingFocusGroup-D2axv7HO.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./users-lES42Api.js";const M={class:"flex items-center justify-between"},q={class:"m-8 h-[calc(100vh-150px)] w-full rounded-xl border border-sidebar-border/70 bg-white p-8 shadow"},A={class:"flex gap-6"},O={class:"flex-1"},P={key:0,class:"mt-1 text-sm text-red-500"},X={class:"w-1/3"},z={key:0,class:"mt-1 text-sm text-red-500"},G={key:0,class:"mt-1 text-sm text-red-500"},H={key:0,class:"mt-1 text-sm text-red-500"},W={class:"relative w-72"},J=["src"],Q={key:0,class:"mt-1 text-sm text-red-500"},Y={class:"flex items-center justify-end gap-4"},Z={key:0,class:"mt-4 font-medium text-green-600"},ue=R({__name:"EditionEdit",props:{edition:{type:Object,required:!0}},setup(C){const x=b(null),d=C,v=b(d.edition.thumbnail),t=S({name:d.edition.name,description:d.edition.description?d.edition.description.replace(/<br\s*\/?>/g,`
`):"",date:d.edition.date,images:d.edition.images,thumbnail:null}),E=s=>{const e=s.target;if(e.files&&e.files[0]){const o=e.files[0];t.thumbnail=o,v.value=URL.createObjectURL(o)}},U=async()=>{const s=new FormData;s.append("_method","PUT");const e=d.edition,o=r=>{const l=t[r],a=e[r];if(l!==a&&l!==null&&l!==void 0)if(r==="date"&&typeof l=="string"){const L=l.split("T")[0];s.append(r,L)}else s.append(r,l)};o("name"),o("description"),o("date"),o("images"),t.thumbnail&&s.append("thumbnail",t.thumbnail),console.log("Submitting FormData with changed fields only...");for(const[r,l]of s.entries())console.log("FD ->",r,l);try{const r=await B.post(`/dashboard/edition/${d.edition.id}/update`,s,{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"multipart/form-data"}});console.log("Laravel response:",r.data),alert("Edition updated successfully!")}catch(r){console.error("Update failed:",r?.response?.data||r),alert("Update failed. Check console / laravel.log.")}},w=b(null),y=s=>{const e=w.value;if(!e)return;const o=e.selectionStart,r=e.selectionEnd,l=t.description.substring(o,r);let a=l;s==="bold"?a=`**${l||"bold text"}**`:s==="italic"?a=`*${l||"italic text"}*`:s==="underline"&&(a=`<u>${l||"underline text"}</u>`),t.description=t.description.substring(0,o)+a+t.description.substring(r),I(()=>{e.focus(),s==="underline"?e.setSelectionRange(o+3,o+a.length-4):s==="bold"?e.setSelectionRange(o+2,o+a.length-2):s==="italic"&&e.setSelectionRange(o+1,o+a.length-1)})},_=s=>{(s.metaKey||s.ctrlKey)&&s.key.toLowerCase()==="b"&&(s.preventDefault(),y("bold")),(s.metaKey||s.ctrlKey)&&s.key.toLowerCase()==="i"&&(s.preventDefault(),y("italic"))};return D(()=>window.addEventListener("keydown",_)),V(()=>window.removeEventListener("keydown",_)),(s,e)=>(m(),u($,null,[h(n(F),{title:"Edit Edition"}),h(N,null,{default:k(()=>[i("div",M,[i("div",q,[e[11]||(e[11]=i("h1",{class:"mb-6 text-2xl font-semibold"},"Edit Edition",-1)),i("form",{onSubmit:T(U,["prevent"]),class:"space-y-6"},[i("div",A,[i("div",O,[e[5]||(e[5]=i("label",{class:"mb-1 block text-sm font-medium"},"Name",-1)),f(i("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n(t).name=o),type:"text",class:"w-full rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200"},null,512),[[g,n(t).name]]),n(t).errors.name?(m(),u("p",P,p(n(t).errors.name),1)):c("",!0)]),i("div",X,[e[6]||(e[6]=i("label",{class:"mb-1 block text-sm font-medium"},"Date",-1)),f(i("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n(t).date=o),type:"date",class:"w-full rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200"},null,512),[[g,n(t).date]]),n(t).errors.date?(m(),u("p",z,p(n(t).errors.date),1)):c("",!0)])]),i("div",null,[e[7]||(e[7]=i("label",{class:"mb-1 block text-sm font-medium"},"Description",-1)),f(i("textarea",{ref_key:"textareaRef",ref:w,"onUpdate:modelValue":e[2]||(e[2]=o=>n(t).description=o),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200"},null,512),[[g,n(t).description]]),n(t).errors.description?(m(),u("p",G,p(n(t).errors.description),1)):c("",!0)]),i("div",null,[e[8]||(e[8]=i("label",{class:"mb-1 block text-sm font-medium"},"Images (Google Photos Album URL)",-1)),f(i("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n(t).images=o),type:"url",placeholder:"https://photos.google.com/album/...",class:"w-full rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200"},null,512),[[g,n(t).images]]),n(t).errors.images?(m(),u("p",H,p(n(t).errors.images),1)):c("",!0)]),i("div",W,[e[10]||(e[10]=i("label",{class:"mb-1 block text-sm font-medium"},"Thumbnail",-1)),i("div",{class:"group relative cursor-pointer overflow-hidden rounded-md border",onClick:e[4]||(e[4]=o=>x.value?.click())},[i("img",{src:v.value,alt:"Current thumbnail",class:"aspect-[3/4] w-full object-cover"},null,8,J),e[9]||(e[9]=i("div",{class:"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 transition group-hover:opacity-100"},[i("span",{class:"font-semibold text-white"},"Edit Thumbnail")],-1))]),i("input",{ref_key:"thumbnailInput",ref:x,type:"file",accept:"image/*",class:"hidden",onChange:E},null,544),n(t).errors.thumbnail?(m(),u("p",Q,p(n(t).errors.thumbnail),1)):c("",!0)]),i("div",Y,[h(n(K),{type:"submit",disabled:n(t).processing},{default:k(()=>[j(p(n(t).processing?"Saving...":"Save Changes"),1)]),_:1},8,["disabled"])]),n(t).recentlySuccessful?(m(),u("p",Z,"Edition updated successfully!")):c("",!0)],32)])])]),_:1})],64))}});export{ue as default};
